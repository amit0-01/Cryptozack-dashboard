"use strict";(self.webpackChunkmaterial_pro_angular_lite=self.webpackChunkmaterial_pro_angular_lite||[]).push([[828],{7828:(pt,T,s)=>{s.r(T),s.d(T,{SupportModule:()=>st});var c=s(4755),x=s(2480),S=s(5861),f=s(3276),m=s(5580),t=s(2223),u=s(3144),Z=s(4004),h=s(2548);let v=(()=>{class e{constructor(n){this.http=n}getsupportData(n){const a=`${h.ij.LIVE_URL}/user-account/list-support`,i=new u.WM({Authorization:`Bearer ${n.token}`}),r=(new u.LE).set("page",n.page).set("limit",n.limit);return this.http.get(a,{headers:i,params:r}).pipe((0,Z.U)(l=>l))}getsupportUserData(n){const a=`${h.ij.LIVE_URL}/user-account/support-byId`,i=new u.WM({Authorization:`Bearer ${n.token}`}),r=(new u.LE).set("supportId",n.supportId);return this.http.get(a,{headers:i,params:r}).pipe((0,Z.U)(l=>l))}replyToUser(n){return this.http.post(`${h.ij.LIVE_URL}/user-account/support-reply`,n)}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(u.eN))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var g=s(6081),d=s(9401),_=s(430),D=s(8097),C=s(3649),M=s(9383);const N=["chatContainer"];function A(e,o){1&e&&(t.TgZ(0,"div",14),t._UZ(1,"ngx-ui-loader",15),t.qZA()),2&e&&(t.xp6(1),t.Q6J("hasProgressBar",!1))}const U=function(e,o){return{left:e,right:o}};function w(e,o){if(1&e&&(t.TgZ(0,"div",16)(1,"p",17),t._uU(2),t.qZA(),t.TgZ(3,"p",18),t._uU(4),t.qZA()()),2&e){const n=o.$implicit,a=t.oxw();t.Q6J("ngClass",t.WLB(3,U,"issue"===n.type,"replies"===n.type)),t.xp6(2),t.Oqu(n.text),t.xp6(2),t.Oqu(a.getTimeDifference(n.timestamp))}}let I=(()=>{class e{constructor(n,a,i){this.supportService=n,this.dialogRef=a,this.data=i,this.replyMessage="",this.chatData=[],this.showLoader=!1;let r=localStorage.getItem("userinfo");r&&(this.parseData=JSON.parse(r))}ngOnInit(){this.getSupport(),this.supportInterval=setInterval(()=>{this.getSupport()},1e4)}ngOnDestroy(){clearInterval(this.supportInterval)}ngAfterViewChecked(){this.scrollToBottom()}scrollToBottom(){try{this.chatContainer.nativeElement.scrollTop=this.chatContainer.nativeElement.scrollHeight}catch{}}getSupport(){this.supportService.getsupportUserData({token:this.parseData.token,supportId:this.data.id}).subscribe(a=>{if(this.clientData=a.data,this.clientData.issue&&Array.isArray(this.clientData.issue))for(let i=0;i<this.clientData.issue.length;i++)this.clientData.issue[i].type="issue";if(this.clientData.replies&&Array.isArray(this.clientData.replies))for(let i=0;i<this.clientData.replies.length;i++)this.clientData.replies[i].type="replies";this.sortedMessages=this.sortMessages([...this.clientData.issue||[],...this.clientData.replies||[]])})}sortMessages(n){return n.sort((a,i)=>new Date(a.timestamp).getTime()-new Date(i.timestamp).getTime())}getTimeDifference(n){const a=new Date(n).getTime(),i=Date.now(),r=Math.floor((i-a)/6e4);return r<1?"Just now":r<60?r+" min ago":r<1440?Math.floor(r/60)+" hours "+r%60+" min ago":r<17280?Math.floor(r/1440)+" days "+Math.floor(r%1440/60)+" hours ago":Math.floor(r/1440)+" days ago"}replyToUser(){this.replyMessage.length>0&&this.supportService.replyToUser({supportId:this.data.id,replies:this.replyMessage}).subscribe(a=>{a&&(this.getSupport(),this.replyMessage="")})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(v),t.Y36(m.so),t.Y36(m.WI))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-reply"]],viewQuery:function(n,a){if(1&n&&t.Gf(N,5),2&n){let i;t.iGM(i=t.CRH())&&(a.chatContainer=i.first)}},decls:18,vars:5,consts:[["class","ngxLoader",4,"ngIf"],[1,"toolbar"],[2,"text-transform","capitalize"],[1,"spacer"],["mat-dialog-close","","matTooltip","Close",1,"pointer"],[2,"height","400px"],["id","chat_container",1,"chat_container"],["chatContainer",""],["class","message",3,"ngClass",4,"ngFor","ngForOf"],[1,"reply_container"],[1,"replyField"],["matInput","","placeholder","Send a message...",1,"searchInput",3,"ngModel","ngModelChange","keyup.enter"],["input",""],["matTooltip","Send",1,"sendIcon",3,"click"],[1,"ngxLoader"],[3,"hasProgressBar"],[1,"message",3,"ngClass"],[1,"messages"],[1,"timestamp"]],template:function(n,a){1&n&&(t.YNc(0,A,2,1,"div",0),t.TgZ(1,"div",1)(2,"mat-toolbar",1)(3,"span",2),t._uU(4),t.qZA(),t._UZ(5,"div",3),t.TgZ(6,"mat-icon",4),t._uU(7,"close"),t.qZA()()(),t.TgZ(8,"div",5)(9,"div",6,7),t.YNc(11,w,5,6,"div",8),t.qZA(),t.TgZ(12,"div",9)(13,"div",10)(14,"input",11,12),t.NdJ("ngModelChange",function(r){return a.replyMessage=r})("keyup.enter",function(){return a.replyToUser()}),t.qZA(),t.TgZ(16,"mat-icon",13),t.NdJ("click",function(){return a.replyToUser()}),t._uU(17,"send"),t.qZA()()()()),2&n&&(t.Q6J("ngIf",a.showLoader),t.xp6(4),t.AsE("",a.data.user.firstName," ",a.data.user.lastName,""),t.xp6(7),t.Q6J("ngForOf",a.sortedMessages),t.xp6(3),t.Q6J("ngModel",a.replyMessage))},dependencies:[c.mk,c.sg,c.O5,g.Eo,d.Fj,d.JJ,d.On,_.Hw,D.Nt,C.gM,M.Ye,m.ZT],styles:[".toolbar[_ngcontent-%COMP%]{background-color:#1e88e5;color:#fff}.reply_container[_ngcontent-%COMP%]{align-items:baseline;text-align:center}.replyField[_ngcontent-%COMP%]{width:400px;display:flex;align-self:baseline;margin:20px}.replyField[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:400px;height:45px;border:1px solid #CCCBCB;border-radius:25px;background-color:#fff;padding-left:15px}.replyField[_ngcontent-%COMP%]   .sendIcon[_ngcontent-%COMP%]{width:20px;height:20px;color:#8c8888;background-color:#fff;margin-left:-32px;margin-top:10px;cursor:pointer}.replyField[_ngcontent-%COMP%]   .sendIcon[_ngcontent-%COMP%]:hover{color:#464141}.chat_container[_ngcontent-%COMP%]{padding:5px}.chat_container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:300px;overflow-y:scroll}.message[_ngcontent-%COMP%]{padding:5px;margin:5px;max-width:70%;word-wrap:break-word;line-height:20px}.message[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]{font-size:18px;font-weight:600;margin:5px}.message[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-size:10px;text-align:right;margin-bottom:0;margin-top:2px}.message.left[_ngcontent-%COMP%]{align-self:flex-start;background-color:#f0f0f0;border-radius:5px}.message.right[_ngcontent-%COMP%]{align-self:flex-end;background-color:#d5e8d4;border-radius:5px}"]}),e})();var p=s(3627);function O(e,o){1&e&&(t.TgZ(0,"div",26),t._UZ(1,"ngx-ui-loader",27),t.qZA()),2&e&&(t.xp6(1),t.Q6J("hasProgressBar",!1))}function P(e,o){1&e&&(t.TgZ(0,"th",28),t._uU(1,"Name "),t.qZA())}function Y(e,o){if(1&e&&(t.TgZ(0,"td",29),t._uU(1),t.qZA()),2&e){const n=o.$implicit;t.xp6(1),t.AsE(" ",n.user.firstName," ",n.user.lastName," ")}}function R(e,o){1&e&&(t.TgZ(0,"th",28),t._uU(1,"Email"),t.qZA())}function Q(e,o){if(1&e&&(t.TgZ(0,"td",30),t._uU(1),t.qZA()),2&e){const n=o.$implicit;t.xp6(1),t.hij(" ",n.user.email," ")}}function J(e,o){1&e&&(t.TgZ(0,"th",28),t._uU(1,"Ticket No"),t.qZA())}function k(e,o){if(1&e&&(t.TgZ(0,"td",31),t._uU(1),t.qZA()),2&e){const n=o.$implicit;t.xp6(1),t.hij(" ",n.ticketNo," ")}}function L(e,o){1&e&&(t.TgZ(0,"th",28),t._uU(1,"Title "),t.qZA())}function B(e,o){if(1&e&&(t.TgZ(0,"td",32),t._uU(1),t.qZA()),2&e){const n=o.$implicit;t.xp6(1),t.hij(" ",n.title," ")}}function E(e,o){1&e&&(t.TgZ(0,"th",28),t._uU(1,"Date & Time"),t.qZA())}const q=function(e){return{color:e}};function b(e,o){if(1&e&&(t.TgZ(0,"td",33),t._uU(1),t.ALo(2,"date"),t.qZA()),2&e){const n=o.$implicit;t.Q6J("ngStyle",t.VKq(5,q,"PENDING"===n.status?"#f5bb8c":"green")),t.xp6(1),t.hij(" ",t.xi3(2,2,n.createdAt,"MMMM dd, y , hh:mm:ss a")," ")}}function z(e,o){1&e&&(t.TgZ(0,"th",28),t._uU(1,"Status"),t.qZA())}function F(e,o){1&e&&(t.TgZ(0,"span",36),t._uU(1,"PENDING"),t.qZA())}function $(e,o){1&e&&(t.TgZ(0,"span",37),t._uU(1,"RESOLVED"),t.qZA())}function j(e,o){if(1&e&&(t.TgZ(0,"td",30),t.YNc(1,F,2,0,"span",34),t.YNc(2,$,2,0,"span",35),t.qZA()),2&e){const n=o.$implicit;t.xp6(1),t.Q6J("ngIf","PENDING"==n.status),t.xp6(1),t.Q6J("ngIf","RESOLVED"==n.status)}}function G(e,o){1&e&&(t.TgZ(0,"th",38),t._uU(1,"Message"),t.qZA())}function H(e,o){if(1&e&&(t.TgZ(0,"td",30),t._uU(1),t.qZA()),2&e){const n=o.$implicit;t.xp6(1),t.hij(" ",n.issue&&n.issue[0].text||"--"," ")}}function V(e,o){1&e&&(t.TgZ(0,"th",28),t._uU(1," Action"),t.qZA())}function W(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"mat-icon",41),t.NdJ("click",function(){t.CHM(n);const i=t.oxw().$implicit,r=t.oxw();return t.KtG(r.reply(i))}),t._uU(1,"reply"),t.qZA()}}function X(e,o){1&e&&(t.TgZ(0,"mat-icon",42),t._uU(1,"remove_circle"),t.qZA())}function K(e,o){if(1&e&&(t.TgZ(0,"td",30),t.YNc(1,W,2,0,"mat-icon",39),t.YNc(2,X,2,0,"mat-icon",40),t.qZA()),2&e){const n=o.$implicit;t.xp6(1),t.Q6J("ngIf","PENDING"==n.status),t.xp6(1),t.Q6J("ngIf","PENDING"==n.status)}}function tt(e,o){1&e&&t._UZ(0,"tr",43)}function et(e,o){1&e&&t._UZ(0,"tr",44)}function nt(e,o){1&e&&(t.TgZ(0,"tr",45)(1,"td",46),t._uU(2,"No data matching the filter "),t.qZA()())}const ot=function(){return[15,25,50,75,100]},at=[{path:"",component:(()=>{class e{constructor(n,a,i){this.supportService=n,this.ngxService=a,this.matdialog=i,this.displayedColumns=["name","email","ticket","title","status","time","message","reply"],this.dataSource=[],this.showLoader=!1,this.newTicketIssue="";let r=localStorage.getItem("userinfo");r&&(this.parseData=JSON.parse(r))}ngOnInit(){this.initializeFilter(),this.getData()}getData(){var n=this;return(0,S.Z)(function*(){yield n.getSupport()})()}initializeFilter(){this.filter={token:this.parseData.token,page:1,limit:15}}getSupport(){var n=this;return(0,S.Z)(function*(){n.showLoader=!0,n.ngxService.start();try{const a=yield n.supportService.getsupportData(n.filter).toPromise();n.dataSource=a.data.results,n.Replies=a.data.results[0].issue[0],n.totalLength=a.data.count,n.showLoader=!1}catch{n.showLoader=!1}})()}pageChange(n){this.filter.page=n.pageIndex+1,this.filter.limit=n.pageSize,this.getSupport()}reply(n){this.matdialog.open(I,{width:"450px",data:n})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(v),t.Y36(g.LA),t.Y36(m.uw))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-support"]],viewQuery:function(n,a){if(1&n&&t.Gf(f.NW,7),2&n){let i;t.iGM(i=t.CRH())&&(a.paginator=i.first)}},decls:36,vars:7,consts:[["class","ngxLoader",4,"ngIf"],[1,"main_container"],[1,"flex","pad-8","header"],[1,"heading"],[1,"spacer"],[2,"margin-top","10px"],["mat-table","",1,"dataTable",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","capital",4,"matCellDef"],["matColumnDef","email"],["mat-cell","",4,"matCellDef"],["matColumnDef","ticket"],["mat-cell","","style","padding-left: 30px;",4,"matCellDef"],["matColumnDef","title"],["mat-cell","","style","color: red; text-transform: capitalize;",4,"matCellDef"],["matColumnDef","time"],["mat-cell","",3,"ngStyle",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","message"],["mat-header-cell","","style","width: 15%; word-wrap:normal;",4,"matHeaderCellDef"],["matColumnDef","reply"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","cursor-pointer",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["pageSize","15",1,"pagination",3,"length","pageSizeOptions","page"],[1,"ngxLoader"],[3,"hasProgressBar"],["mat-header-cell",""],["mat-cell","",1,"capital"],["mat-cell",""],["mat-cell","",2,"padding-left","30px"],["mat-cell","",2,"color","red","text-transform","capitalize"],["mat-cell","",3,"ngStyle"],["style","color: #f5bb8c;",4,"ngIf"],["style","color: green;",4,"ngIf"],[2,"color","#f5bb8c"],[2,"color","green"],["mat-header-cell","",2,"width","15%","word-wrap","normal"],["class","pointer reply","matTooltip","Reply To User",3,"click",4,"ngIf"],["class","remove","matTooltip","Resolve Ticket",4,"ngIf"],["matTooltip","Reply To User",1,"pointer","reply",3,"click"],["matTooltip","Resolve Ticket",1,"remove"],["mat-header-row",""],["mat-row","",1,"cursor-pointer"],[1,"mat-row"],["colspan","5",1,"pad-16",2,"text-align","center"]],template:function(n,a){1&n&&(t.YNc(0,O,2,1,"div",0),t.TgZ(1,"div",1)(2,"div",2)(3,"p",3),t._uU(4,"Support "),t.qZA(),t._UZ(5,"div",4),t.qZA(),t.TgZ(6,"div",5)(7,"table",6),t.ynx(8,7),t.YNc(9,P,2,0,"th",8),t.YNc(10,Y,2,2,"td",9),t.BQk(),t.ynx(11,10),t.YNc(12,R,2,0,"th",8),t.YNc(13,Q,2,1,"td",11),t.BQk(),t.ynx(14,12),t.YNc(15,J,2,0,"th",8),t.YNc(16,k,2,1,"td",13),t.BQk(),t.ynx(17,14),t.YNc(18,L,2,0,"th",8),t.YNc(19,B,2,1,"td",15),t.BQk(),t.ynx(20,16),t.YNc(21,E,2,0,"th",8),t.YNc(22,b,3,7,"td",17),t.BQk(),t.ynx(23,18),t.YNc(24,z,2,0,"th",8),t.YNc(25,j,3,2,"td",11),t.BQk(),t.ynx(26,19),t.YNc(27,G,2,0,"th",20),t.YNc(28,H,2,1,"td",11),t.BQk(),t.ynx(29,21),t.YNc(30,V,2,0,"th",8),t.YNc(31,K,3,2,"td",11),t.BQk(),t.YNc(32,tt,1,0,"tr",22),t.YNc(33,et,1,0,"tr",23),t.YNc(34,nt,3,0,"tr",24),t.qZA(),t.TgZ(35,"mat-paginator",25),t.NdJ("page",function(r){return a.pageChange(r)}),t.qZA()()()),2&n&&(t.Q6J("ngIf",a.showLoader),t.xp6(7),t.Q6J("dataSource",a.dataSource),t.xp6(25),t.Q6J("matHeaderRowDef",a.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns),t.xp6(2),t.Q6J("length",a.totalLength)("pageSizeOptions",t.DdM(6,ot)))},dependencies:[c.O5,c.PC,p.BZ,p.fO,p.as,p.w1,p.Dz,p.nj,p.ge,p.ev,p.XQ,p.Gk,p.Ee,f.NW,g.Eo,_.Hw,C.gM,c.uU],styles:[".main_container[_ngcontent-%COMP%]{padding:0 10px}.reply[_ngcontent-%COMP%]{margin-right:5px}.reply[_ngcontent-%COMP%]:hover{color:#1e88e5}.remove[_ngcontent-%COMP%]:hover{cursor:pointer;color:green}"]}),e})()}];let it=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[x.Bz.forChild(at),x.Bz]}),e})();var rt=s(1728);let st=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[c.ez,it,p.p0,f.TU,g.Js,d.u5,_.Ps,D.c,C.AV,M.g0,m.Is,rt.ot]}),e})()}}]);